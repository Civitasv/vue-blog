<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blog.application.mapper.ArticleMapper">
    <!--使用自定义结果集类型-->
    <resultMap type="Article" id="ArticleMap">
        <!-- column是查询结果的列名，可以来自不同的表-->
        <id property="articleID" column="ARTICLE_ID"/>
        <result property="publicTime" column="PUBLIC_TIME"/>
        <result property="title" column="TITLE"/>
        <result property="digest" column="DIGEST"/>
        <result property="content" column="CONTENT"/>
        <result property="heat" column="HEAT"/>
        <result property="commendNum" column="COMMEND_NUM"/>
        <result property="readNum" column="READ_NUM"/>
        <collection property="comments" ofType="Comment">
            <id property="commentID" column="COMMENT_ID" />
            <result property="content" column="CONTENT" />
            <result property="commentTime" column="COMMENT_TIME" />
            <result property="commentNum" column="COMMENT_NUM" />
            <result property="commentName" column="COMMENT_NAME" />
            <result property="email" column="EMAIL" />
        </collection>
        <collection property="labels" ofType="Label">
            <id property="labelID" column="LABEL_ID"/>
            <result property="label" column="LABEL"/>
        </collection>
    </resultMap>

    <select id="getAllArticles" resultMap="ArticleMap">
        select * from article,comment,label
    </select>

    <select id="getArticleByID" resultMap="ArticleMap">
        select * from article,comment,label where article.ARTICLE_ID=#{articleID}
    </select>

    <delete id="deleteArticleByTD">
        delete from article where ARTICLE_ID = #{articleID}
    </delete>

    <update id="updateArticleByID">
         update article set
            PUBLIC_TIME = #{publicTime},
            TITLE = #{title},
            DIGEST = #{digest},
            CONTENT = #{content},
            HEAT = #{heat},
            COMMEND_NUM = #{commendNum},
            READ_NUM = #{readNum}
          where ARTICLE_ID = #{articleID}
    </update>

    <insert id="insertArticle" parameterType="Article" flushCache="true" timeout="20">
        insert into article(PUBLIC_TIME,TITLE,DIGEST,CONTENT,HEAT,COMMEND_NUM,READ_NUM)
        values (#{publicTime},#{title},#{digest},#{content},#{heat},#{commendNum},#{readNum})
    </insert>

</mapper>